<html>
   <style> pre.small {line-height: 0.5; color: #0000FF; } </style>
   <style> CMD {line-height: 0.5; color: #0000FF; } </style>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <h2 class="title">Урок 2. Элаборация</h2>
      <p>Данный урок дает рекомендации по компиляции дизайна и оценке ресурсов дизайна на уровне RTL.</p>
      <hr>
      <h4>В ходе урока Вы изучите:</h4>
      <ul>
         <li>Параметры запуска <b>eshell</b>;</li>
         <li>Процесс настройки и анализа сообщений;</li>
         <li>Принцип анализа отчетов: оценку ресурсов и временных характеристик схемы.</li>
      </ul>
      <hr>
      <h4>Действия:</h4>
      <span style="color: #FF0000"><h4>КОМПИЛЯЦИЯ</h4></span>
      <li>Откройте консоль. Перейдите в каталог урока (<b>01_elaboration</b>).</li>
      <li>Запустите <b>eshell</b> для отображения списка доступных опций: <b>eshell.exe -help</b>.</li>
      <p>В результате выполнения команды будет выведен список доступных аргументов (может отличаться от представленного ниже из-за различия в версиях программы).</p>
      <pre class="small"></pre>
      <pre class="small">   eshell - logic synthesis tool for converting Verilog RTL into gate-level.</pre>
      <pre class="small"></pre>
      <pre class="small">========== SYNTAX ==========</pre>
      <pre class="small"></pre>
      <pre class="small">   eshell.exe [-nolog] [-quiet] [-noinit] [-tcl] [-script <filename>] [-help] [-dir <directory>]</pre>
      <pre class="small"></pre>
      <pre class="small">========== OPTIONS ==========</pre>
      <pre class="small"></pre>
      <pre class="small">    -nolog    do not write into log file. Can be used to avoid writing to disk and improve run-time during debugging</pre>
      <pre class="small">    -quiet    do not write messages into console. Can be used to not print messages into console for further log investigation. This option cleared after executing autosetup.tcl (or -script) and entering into interactive mode</pre>
      <pre class="small">    -noinit   do not run autosetup.tcl (or -script) on startup</pre>
      <pre class="small">    -tcl      run in tcl mode (to be run from tclsh) as opposed to internal auto-completion mode</pre>
      <pre class="small">    -nodb     do no write compiled modules into database - useful for compilation regressions to avoid write to file (edb) stage</pre>
      <pre class="small">    -script   execute script file specified with this option instead of autosetup.tcl (if specified without -noinit)</pre>
      <pre class="small">    -dir      keep session database and log in the specified directory (default one is tool run directory)</pre>
      <pre class="small">    -help     this help message</pre>
      <pre class="small"></pre>

      <p>Представленные аргументы могут использоваться для удовлетворения различных требований пользователя.</p>
      <p>Например, для проверки компилируемости дизайна (за исключением SystemVerilog packages) аргумент <b>-nodb</b> может быть использован для сокращения времени компиляции за счет отказа от сохранения скомпилированного модуля в базу на диске.</p>

      <li>Запустите программу (<b>eshell.exe -nodb</b>), установите уровень сообщений на NOTE (<CMD>message NOTE</CMD>) и выполните подготовленный скрипт (<CMD>source read.tcl</CMD>).</li>
      <li>Оцените количество сообщений программы с помощью <CMD>report_lint -clear</CMD>.</li>
      <li>Просмотрите отчет. Он содержит сообщения, помеченные буквами N (note) и W (warning). Выполните <CMD>message WARN</CMD> для исключения менее значимых сообщений из отчета.</li>
      <li>Выполните скрипт еще раз и проверьте статичтику сообщений.</li>
      <li>Осталось 3 типа сообщений: ADV-63, ADV-68, ADV-71.</li>
      <li>Допустим, мы знаем, что сообщений ADV-63 и ADV-68 не вляют на наш текущий дизайн, так что мы можем отключить их <CMD>unset ADV-63</CMD> и <CMD>unset ADV-68</CMD>.</li>
      <li>Выполните скрипт еще раз и обратите внимание на сообщение ADV-71. Найдите его в логе и определите причину сообщения.</li>
      <li>Исправьте проблему (решение можно посмотреть в файле <b>ehl_sdram.v.FIXED</b>), вызванную использованием конструкции <b>defparam</b>. Она создает потенциально ошибочное поведение Verilog модели, поскольку позволяет переопределять параметры модуля в нескольких источниках в коде без предопределенного порядка переопределений. Эта конструкция помечена, как предназначенная к исключению в последнем стандарте SystemVerilog.</li>
      <li>Перезапустите компиляцию и генерацию отчетов. Заметьте, что лог пуст, дизайн исправлен от выбранных проблем.</li>

      <span style="color: #FF0000"><h4>ЭЛАБОРАЦИЯ</h4></span>
      <p>Скомпилированный дизайн может быть далее проверен на синтезируемость. Поскольку не все части дизайна могут быть готовы во время начальной отладки, <b>eshell</b> позволяет проводить элаборацию неполного описания проекта.</p>
      <li>Попробуйте элаборировать дизайн с помощью <CMD>build ehl_sdram</CMD>. Ошибка сгенерирована, поскольку данный дизайн отсутствует в базе данных. Программа была запущена с аргументом <b>-nodb</b>. Перезапустите программу без указанной опции.</li>
      <li>Скомпилируйте и элаборируйте дизайн. Элаборация завершилась с ошибкой из-за отсутсвия некоторых модулей. Для активации режима работы с отсутствующими модулями (режим "черных ящиков") выполните <CMD>unset break_elab_on_unreferenced_instance</CMD>.</li>
      <li>Повторите элаборацию и убедитесь в ее успешном завершении. Также, обратите внимание на наличие сообщений ADV-108 и ADV-146.</li>
      <p>ADV-108 перечисляет инстансы в дизайне, которые не имеют функционального описания. <b>eshell</b> размещает их в нетлисте, но не создает их наполнение. Если программа корректно угадала направление выводов, то нетлист может быть использован в маршруте с "черными ящиками", описанными в отдельном файле. Однако, применение маршрута с "черными ящиками" не рекомендуется для финальной реализации дизайна.</p>
      <p>ADV-146 говорит о том, что некоторые сигналы в дизайне используются, не имея присвоения. Просмотрите код и обратите внимание, что части сигналов присваевается значение только при параметре <b>FT_ENA</b> равном 1, в то время как значение по умолчанию для него - 0.</p>
      <li>Исправьте сообщение ADV-146, присовив значение 0 перечисленным сигналам при <b>FT_ENA</b> = 1. Возмоджный вариант решения может быть найден в <b>ehl_sdram.v.FIXED2</b>.</li>
      <li>Повторно скомпилируйте и элаборируйте дизайн. Оцените аппаратные ресурсы с помощью <CMD>report_hierarchy -resources</CMD>. Статистика показывает начальные ресурсы. Запишите количестве вентилей и триггеров для последующего сравнения.</li>
      <p>На данном этапе дизайн содержит все триггеры и иерархические модули, представленные в оригинальном RTL описании (за исключением спрятанных конструкцией generate). Это сделано для того, чтобы при чтении SDC сократить количество ошибок.</p>
      <li>Оцените временные характеристики дизайна с помощью команды <CMD>report_timing</CMD>, которая выведет информацию о наиболее длинном комбинаторном пути в дизайне. Заметьте, что существует различие во времени прихода 2 сигналов для большинства узлов в критическом пути.</li>
      <li>Запустите оптимизацию дизайна (программа выполнит некоторые оптимизации, направленные на сокращение критического пути, поскольку перед этим была выполнена команда <CMD>report_timing</CMD>) - <CMD>opt</CMD>. Заметьте, что общее количество аппаратных ресурсов уменьшилось. Запустите рекурсивную оптимизацию <CMD>opt -recursive</CMD>.</li>
      <p>Во время оптимизации программа старается минимизировать количество аппаратных ресурсов. Временные параметры схемы учитываются только для некоторых алгоритмов минимизации аппаратных ресурсов.</p>
      <li>По окончании оптимизаций проверьте временные параметры схемы. Они должны незначительно уменьшиться. Для оптимизации временных характеристик используйте <CMD>opt -time</CMD>.</li>
      <li>Проверьте временные параметры еще раз. Заметьте, что время прибытия синалов для большинства вентилей в критическом пути сбалансировалось, а сам критический путь сократился.</li>
      <li>Запустите оптимизацию для удаления избыточной логики, созданной на предыдущем этапе. Заметьте, что общее количество вентилей увеличилось (начальное значение указано в "()"). Как правило, оптимизация временных параметров приводит к росту используемых аппаратных ресурсов.</li>
      <li>Запустите финальную проверку <CMD>report_design</CMD>.</li>
      <p>На данном этапе мы имеем дизайн, собранный из исходного RTL описания, позволяющий оценить аппаратные ресурсы и достижимые тактовые частоты.</p>
      <hr>

      <h4>Далее:</h4>
      <p>В <a href="02_gui.html" target="Frame_data" class="olink">следующем уроке</a>Вы изучите основы использования графического интерфейса <b>eshell</b>.</p>
   </body>
</html>
